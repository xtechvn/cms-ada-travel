@using Entities.Models
@model PagedResult<TicketListItemViewModel>

    <style>
    /* ✅ Khung cuộn ngang cho bảng */
    .table-wrap-scroll {
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap; /* tránh cell xuống dòng */
        -webkit-overflow-scrolling: touch; /* cuộn mượt trên iOS */
    }

    /* ✅ Bảng đủ rộng, không bị bóp */
    .table-wide {
        min-width: 1200px; /* bạn có thể tăng lên 1400–1600 nếu nhiều cột */
    }

    /* ✅ Header “dính” khi cuộn (tuỳ chọn) */
    .sticky-header th {
        position: sticky;
        top: 0;
        z-index: 2; /* nổi lên trên body */
        background: #f8f9fa; /* đồng bộ Bootstrap table-light */
    }

    /* ✅ Căn phải cột “Giá nhập” (cột thứ 4) — nếu bạn muốn chung */
    .table-wide td:nth-child(4),
    .table-wide th:nth-child(4) {
        text-align: right;
    }

    /* ✅ (Tuỳ chọn) Định độ rộng tối thiểu cho vài cột để dễ đọc */
    .table-wide th:nth-child(2), .table-wide td:nth-child(2) {
        min-width: 180px;
    }
    /* MÃ SỐ */
    .table-wide th:nth-child(3), .table-wide td:nth-child(3) {
        min-width: 220px;
    }
    /* TÊN SẢN PHẨM */
    .table-wide th:nth-child(10), .table-wide td:nth-child(10) {
        min-width: 220px;
    }
    /* KHU VỰC */

    </style>
<div class="card shadow-sm border-0">
    <!-- ✅ Lớp bao để bật cuộn ngang -->
    <div class="table-wrap-scroll">
        <table class="table table-hover align-middle mb-0 table-wide">
            <thead class="table-light text-center sticky-header">
                <!-- ✅ sticky header (nếu muốn) -->
                <tr>
                    <th>STT</th>
                    <th>MÃ SỐ</th>
                    <th>TÊN SẢN PHẨM</th>
                    <th>GIÁ NHẬP</th>
                    <th>ĐỐI TƯỢNG</th>
                    <th>NGÀY NHẬP</th>
                    <th>NGÀY HẾT HẠN</th>
                    <th>DANH MỤC</th>
                    <th>LOẠI VÉ</th>
                    <th>KHU VỰC VUI CHƠI</th>
                    <th>TRẠNG THÁI</th>
                    <th>THỜI GIAN ĐÃ BÁN</th>
                    <th>QR CODE</th>
                    <th>THAO TÁC</th>
                </tr>
            </thead>
            <tbody class="text-center">
                @if (Model?.Items != null && Model.Items.Any())
                {
                    int index = 1 + (Model.PageIndex - 1) * Model.PageSize;
                    foreach (var item in Model.Items)
                    {
                        <tr>
                            <td>@index</td>
                            <td class="text-primary fw-semibold">@item.TicketCode</td>
                            <td>@item.ProductName</td>
                            <td class="text-end">@String.Format("{0:N0} đ", item.ImportPrice)</td>
                            <td>@item.TargetAudienceName</td>
                            <td>@(item.ImportDate?.ToString("dd/MM/yyyy"))</td>
                            <td>@(item.ExpiredDate?.ToString("dd/MM/yyyy"))</td>
                            <td>@item.CategoryName</td>
                            <td>@item.TicketTypeName</td>
                            <td>@item.PlayZoneName</td>
                            <td>
                                <span class="@(item.StatusName == "CHƯA SỬ DỤNG" ? "status-green" :
                                    item.StatusName == "ĐÃ SỬ DỤNG" ? "status-yellow" :
                                    item.StatusName == "HOÀN VÉ" ? "status-red" :
                                    item.StatusName == "ĐÃ BÁN NHƯNG CHƯA DÙNG" ? "status-blue" :
                                    "status-grey")">
                                    @item.StatusName
                                </span>
                            </td>
                            <td>@item.SoldDurationDisplay</td>
                            <td>
                                @if (item.Status == 1 && item.ExpiredDate >= DateTime.Now)
                                {
                                    <a href="javascript:void(0);" class="text-primary text-decoration-none"
                                       onclick="_ticket_service.ShowTicketPopup(@item.TicketId, @item.Status)">
                                        Xem vé
                                    </a>
                                }
                                else if (item.ExpiredDate < DateTime.Now)
                                {
                                    <span class="text-danger">Hết hạn</span>
                                }
                                else
                                {
                                    <span class="text-muted">Đã sử dụng</span>
                                }
                            </td>
                            <td>
                                @if (item.Status == 2)
                                {
                                    <span class="text-secondary" title="Không thể sửa vé đã sử dụng" style="cursor:not-allowed; opacity:0.4;">
                                        <i class="fa fa-pencil-square-o"></i>
                                    </span>
                                }
                                else
                                {
                                    <a href="javascript:void(0);" class="text-primary"
                                       onclick="_ticket_service.ShowAddOrUpdate('@item.TicketId')"
                                       title="Sửa vé">
                                        <i class="fa fa-pencil-square-o"></i>
                                    </a>
                                }
                            </td>
                        </tr>
                        index++;
                    }
                }
                else
                {
                    <!-- ✅ nhớ chỉnh colspan đúng số cột -->
                    <tr><td colspan="14" class="text-muted text-center py-3">Không có dữ liệu</td></tr>
                }
            </tbody>
        </table>
    </div>

    @if (Model.TotalPages > 1)
    {
        <nav class="mt-3" aria-label="ticket pagination">
            <ul class="pagination justify-content-center">
                @for (int i = 1; i <= Model.TotalPages; i++)
                {
                    <li class="page-item @(i == Model.PageIndex ? "active" : "")">
                        <a class="page-link" href="javascript:void(0)" onclick="_ticket_service.applyFilter(@i)">@i</a>
                    </li>
                }
            </ul>
        </nav>
    }
</div>
